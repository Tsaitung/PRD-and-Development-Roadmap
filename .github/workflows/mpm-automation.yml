name: MPM Automation Pipeline

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'PRD/**'
      - 'docs/**'
      - 'tests/**'
      - 'src/**'
      - 'TOC Modules.md'
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'PRD/**'
      - 'docs/**'
      - 'tests/**'
      - 'src/**'
      - 'TOC Modules.md'
  schedule:
    - cron: '0 2 * * *'
  workflow_dispatch:

jobs:
  check-module-status:
    name: æª¢æŸ¥æ¨¡çµ„ç‹€æ…‹
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install matplotlib seaborn plotly
    
    - name: Run module status check
      run: |
        echo "åŸ·è¡Œæ¨¡çµ„ç‹€æ…‹æª¢æ¸¬..."
        python .github/scripts/check_module_status.py
    
    - name: Commit status updates
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add TOC\ Modules.md module_status_report.md
        git diff --staged --quiet || git commit -m "ğŸ¤– è‡ªå‹•æ›´æ–°: æ¨¡çµ„ç‹€æ…‹è¿½è¹¤ [skip ci]"
        git push || echo "No changes to push"
    
    - name: Upload status report
      uses: actions/upload-artifact@v4
      with:
        name: module-status-report
        path: module_status_report.md
        retention-days: 30
  
  deploy-tracking-platform:
    name: éƒ¨ç½²è¿½è¹¤å¹³å°
    runs-on: ubuntu-latest
    needs: check-module-status
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        ref: ${{ github.ref }}
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install matplotlib seaborn plotly
    
    - name: Verify tracking platform
      run: |
        echo "é©—è­‰è¿½è¹¤å¹³å°..."
        if [ -d "docs/tracking-platform" ]; then
          echo "âœ… çµ±ä¸€è¿½è¹¤å¹³å°å·²å°±ç·’"
        else
          echo "âŒ æ‰¾ä¸åˆ°è¿½è¹¤å¹³å°"
          exit 1
        fi
    
    - name: Deploy to GitHub Pages
      if: github.ref == 'refs/heads/main'
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./docs
        keep_files: false
    
    - name: Upload tracking platform artifacts
      uses: actions/upload-artifact@v4
      with:
        name: tracking-platform
        path: docs/
        retention-days: 30 