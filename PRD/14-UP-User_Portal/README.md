# UP 使用者入口 (User Portal) 模組 PRD

## 文件資訊
- **版本**: v1.0.0
- **最後更新**: 2025-08-25
- **狀態**: 🟡 開發中
- **負責人**: 前端開發團隊
- **審核者**: 產品經理、UX 設計師

## 1. 模組概述

### 1.1 目的
使用者入口模組提供個人化的使用者介面和自助服務功能，讓使用者能夠管理個人資訊、偏好設定、安全設定，並提供統一的系統入口體驗。

### 1.2 範圍
- 使用者個人資訊管理
- 系統偏好設定
- 安全性設定（密碼、雙因素認證）
- 通知偏好管理
- 個人化儀表板配置
- 快速存取功能
- 登出與工作階段管理

### 1.3 關鍵價值
- **個人化體驗**: 依據使用者角色和偏好客製化介面
- **自助服務**: 減少 IT 支援需求 50%
- **安全性提升**: 強化帳戶安全管理
- **使用效率**: 快速存取常用功能，提升 30% 操作效率

## 2. 功能架構

### 2.1 子模組結構
```
UP - User Portal
├── UP-PS - Personal Settings (個人設定)
├── UP-SS - Security Settings (安全設定)
├── UP-NP - Notification Preferences (通知偏好)
├── UP-DC - Dashboard Customization (儀表板客製化)
├── UP-QA - Quick Access (快速存取)
└── UP-SM - Session Management (工作階段管理)
```

## 3. 功能性需求

### FR-UP-001: 使用者個人資料管理
**狀態**: 🟡 開發中
**優先級**: P0

#### 需求描述
- **條件/觸發**: 使用者進入個人設定頁面
- **行為**: 顯示和編輯個人基本資料
- **資料輸入**: 
  - 姓名、職稱、部門
  - 聯絡資訊（電話、Email）
  - 大頭照上傳
  - 時區設定
  - 語言偏好
- **資料輸出**: 
  - 更新後的個人資料
  - 變更歷史記錄
- **UI反應**: 
  - 即時驗證表單
  - 儲存成功提示
  - 大頭照預覽
- **例外處理**: 
  - Email 格式驗證
  - 檔案大小限制（大頭照 < 5MB）
  - 重複 Email 檢查

#### 驗收標準
```yaml
Given: 使用者在個人設定頁面
When: 修改個人資料並點擊儲存
Then: 
  - 資料即時更新到資料庫
  - 顯示成功訊息
  - 記錄變更歷史
  - 更新全系統顯示的使用者資訊
```

#### API 規格
- **Endpoint**: `PUT /api/v1/user/profile`
- **Request**:
  ```json
  {
    "name": "string",
    "title": "string",
    "department": "string",
    "phone": "string",
    "email": "string",
    "timezone": "string",
    "language": "string",
    "avatar": "base64_string"
  }
  ```
- **Response**: 
  ```json
  {
    "success": true,
    "data": {
      "user_id": "string",
      "updated_at": "datetime",
      "changes": []
    }
  }
  ```

### FR-UP-002: 密碼與安全管理
**狀態**: 🔴 未開始
**優先級**: P0

#### 需求描述
- **條件/觸發**: 使用者存取安全設定
- **行為**: 管理密碼和雙因素認證
- **資料輸入**: 
  - 當前密碼
  - 新密碼
  - 確認密碼
  - 2FA 設定（簡訊/App）
  - 安全問題設定
- **資料輸出**: 
  - 密碼強度指示
  - 2FA QR Code
  - 備用碼產生
  - 安全記錄
- **UI反應**: 
  - 密碼強度即時檢測
  - 2FA 設定精靈
  - 安全等級顯示
- **例外處理**: 
  - 密碼複雜度要求
  - 密碼歷史檢查
  - 2FA 驗證失敗處理

#### 驗收標準
```yaml
Given: 使用者要變更密碼
When: 輸入符合要求的新密碼
Then: 
  - 密碼加密儲存
  - 強制其他裝置重新登入
  - 發送變更通知郵件
  - 記錄安全事件
```

### FR-UP-003: 通知偏好設定
**狀態**: 🔴 未開始
**優先級**: P1

#### 需求描述
- **條件/觸發**: 使用者設定通知偏好
- **行為**: 配置各類通知的接收方式
- **資料輸入**: 
  - 通知類型選擇
  - 接收管道（Email/簡訊/系統內）
  - 通知頻率設定
  - 免打擾時段
  - 緊急通知覆寫
- **資料輸出**: 
  - 通知設定摘要
  - 測試通知發送
- **UI反應**: 
  - 分類顯示通知選項
  - 即時預覽效果
  - 批次設定功能
- **例外處理**: 
  - 至少保留一個通知管道
  - 緊急通知不可關閉

#### 驗收標準
```yaml
Given: 使用者配置通知偏好
When: 儲存設定
Then: 
  - 立即生效新設定
  - 依據偏好發送通知
  - 可發送測試通知
  - 記錄設定變更
```

### FR-UP-004: 儀表板個人化
**狀態**: 🔴 未開始
**優先級**: P1

#### 需求描述
- **條件/觸發**: 使用者客製化儀表板
- **行為**: 調整儀表板佈局和內容
- **資料輸入**: 
  - Widget 選擇和排序
  - 版面配置設定
  - 資料更新頻率
  - 顏色主題選擇
  - 預設檢視設定
- **資料輸出**: 
  - 個人化儀表板配置
  - 佈局範本儲存
  - 分享設定（公開/私人）
- **UI反應**: 
  - 拖放式編輯
  - 即時預覽
  - 響應式佈局
  - 重設預設值
- **例外處理**: 
  - 最小 Widget 數量限制
  - 權限檢查（某些 Widget 需特定權限）

#### 驗收標準
```yaml
Given: 使用者在儀表板編輯模式
When: 調整 Widget 位置和設定
Then: 
  - 自動儲存配置
  - 跨裝置同步
  - 可儲存多個範本
  - 支援匯出/匯入配置
```

### FR-UP-005: 快速存取管理
**狀態**: 🔴 未開始
**優先級**: P2

#### 需求描述
- **條件/觸發**: 使用者設定常用功能
- **行為**: 管理快速存取選單和捷徑
- **資料輸入**: 
  - 功能捷徑選擇
  - 自訂捷徑名稱
  - 快捷鍵設定
  - 分組管理
  - 排序優先級
- **資料輸出**: 
  - 個人化快速選單
  - 使用頻率統計
  - 智慧推薦
- **UI反應**: 
  - 快速選單浮動視窗
  - 鍵盤快捷鍵提示
  - 最近使用清單
- **例外處理**: 
  - 快捷鍵衝突檢測
  - 功能權限驗證

### FR-UP-006: 工作階段管理
**狀態**: 🔴 未開始
**優先級**: P0

#### 需求描述
- **條件/觸發**: 管理登入工作階段
- **行為**: 檢視和控制活動工作階段
- **資料輸入**: 
  - 工作階段識別
  - 信任裝置管理
  - 遠端登出指令
- **資料輸出**: 
  - 活動工作階段清單
  - 登入歷史
  - 異常登入警告
  - 裝置資訊
- **UI反應**: 
  - 即時工作階段狀態
  - 一鍵登出所有裝置
  - 可疑活動標記
- **例外處理**: 
  - 不可登出當前工作階段
  - 異常 IP 警告

#### 驗收標準
```yaml
Given: 使用者檢視工作階段
When: 發現可疑登入
Then: 
  - 可立即終止該工作階段
  - 發送安全警告
  - 記錄安全事件
  - 選擇性強制變更密碼
```

### FR-UP-007: 系統偏好設定
**狀態**: 🔴 未開始
**優先級**: P2

#### 需求描述
- **條件/觸發**: 使用者調整系統偏好
- **行為**: 設定系統行為和顯示偏好
- **資料輸入**: 
  - 顯示密度（緊湊/標準/寬鬆）
  - 日期時間格式
  - 數字格式
  - 貨幣顯示
  - 分頁設定
  - 自動儲存間隔
- **資料輸出**: 
  - 偏好設定檔
  - 預設值套用
- **UI反應**: 
  - 即時套用變更
  - 設定匯出/匯入
  - 重設為預設值
- **例外處理**: 
  - 設定值驗證
  - 相容性檢查

## 4. 非功能性需求

### 4.1 效能需求
- 個人設定載入時間 < 1 秒
- 儀表板配置儲存 < 500ms
- 支援同時 1000 個使用者存取
- 大頭照上傳支援最大 5MB

### 4.2 安全需求
- 密碼加密儲存（bcrypt）
- 支援 TOTP 雙因素認證
- 工作階段 Token 加密
- 敏感操作需重新驗證
- 安全事件日誌記錄

### 4.3 可用性需求
- 支援響應式設計（手機/平板/桌面）
- 無障礙標準 WCAG 2.1 AA
- 多語言支援（中文/英文）
- 離線模式基本功能

### 4.4 相容性需求
- 瀏覽器：Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- 行動裝置：iOS 14+, Android 10+
- 螢幕解析度：最小 320px 寬度

## 5. 資料模型

### 5.1 使用者設定表
```sql
CREATE TABLE user_preferences (
    user_id VARCHAR(50) PRIMARY KEY,
    profile_data JSONB,
    security_settings JSONB,
    notification_preferences JSONB,
    dashboard_config JSONB,
    quick_access JSONB,
    system_preferences JSONB,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    version INT
);
```

### 5.2 工作階段表
```sql
CREATE TABLE user_sessions (
    session_id VARCHAR(100) PRIMARY KEY,
    user_id VARCHAR(50),
    device_info JSONB,
    ip_address INET,
    location JSONB,
    created_at TIMESTAMP,
    last_activity TIMESTAMP,
    expires_at TIMESTAMP,
    is_trusted BOOLEAN,
    status VARCHAR(20)
);
```

### 5.3 安全事件表
```sql
CREATE TABLE security_events (
    event_id SERIAL PRIMARY KEY,
    user_id VARCHAR(50),
    event_type VARCHAR(50),
    event_data JSONB,
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMP,
    severity VARCHAR(20)
);
```

## 6. 整合需求

### 6.1 相關模組
- **SA-UPM**: 使用者權限管理
- **DSH-NC**: 通知中心整合
- **DSH-OV**: 儀表板元件共用
- **SA-SLM**: 系統日誌記錄

### 6.2 外部系統
- **LDAP/AD**: 單一登入整合
- **郵件伺服器**: 通知發送
- **簡訊閘道**: 2FA 驗證碼
- **CDN**: 大頭照儲存

## 7. 使用者故事

### 故事 1: 新員工設定個人資料
```
作為一名新進員工
我想要快速設定我的個人資料和偏好
以便開始使用系統並接收相關通知
```

### 故事 2: 資安人員管理工作階段
```
作為資訊安全人員
我想要監控和管理所有登入工作階段
以便及時發現和處理異常登入
```

### 故事 3: 主管客製化儀表板
```
作為部門主管
我想要客製化我的儀表板顯示重要 KPI
以便快速掌握部門營運狀況
```

## 8. 測試案例

### 8.1 單元測試
- 密碼強度驗證邏輯
- 通知偏好過濾器
- 工作階段 Token 生成
- 儀表板配置驗證

### 8.2 整合測試
- 登入流程與工作階段建立
- 通知發送管道測試
- 權限變更同步測試
- 跨模組資料一致性

### 8.3 E2E 測試
- 完整的個人設定流程
- 密碼重設流程
- 2FA 設定和驗證
- 儀表板客製化和儲存

## 9. 部署需求

### 9.1 環境需求
- Node.js 18+
- PostgreSQL 14+
- Redis 6+ (工作階段快取)
- Nginx (靜態資源)

### 9.2 配置管理
- 環境變數管理
- 密碼政策配置
- 工作階段逾時設定
- 通知管道配置

## 10. 維護與支援

### 10.1 監控指標
- 登入成功/失敗率
- 工作階段平均時長
- 設定變更頻率
- 安全事件統計

### 10.2 備份策略
- 使用者偏好每日備份
- 安全事件永久保存
- 工作階段資料 30 天保留

## 11. 風險評估

| 風險項目 | 可能性 | 影響 | 緩解措施 |
|---------|--------|------|----------|
| 密碼洩露 | 中 | 高 | 強制密碼複雜度、定期變更 |
| 工作階段劫持 | 低 | 高 | HTTPS、Token 加密、IP 驗證 |
| 偏好設定遺失 | 低 | 中 | 自動備份、版本控制 |
| 2FA 裝置遺失 | 中 | 中 | 備用碼、管理員重設 |

## 12. 時程規劃

| 階段 | 功能 | 預計時程 | 負責團隊 |
|------|------|----------|----------|
| Phase 1 | FR-UP-001, FR-UP-002, FR-UP-006 | 2 週 | 前端團隊 |
| Phase 2 | FR-UP-003, FR-UP-004 | 2 週 | 前端團隊 |
| Phase 3 | FR-UP-005, FR-UP-007 | 1 週 | 前端團隊 |
| Phase 4 | 整合測試與優化 | 1 週 | QA 團隊 |

## 13. 成功指標

- 使用者自助服務率 > 80%
- 密碼重設請求減少 50%
- 個人化設定使用率 > 60%
- 使用者滿意度 > 4.0/5.0
- 安全事件回應時間 < 5 分鐘

## 14. 附錄

### 14.1 參考文件
- OWASP 安全指南
- WCAG 2.1 無障礙標準
- Material Design 指南
- 公司資安政策

### 14.2 術語表
- **2FA**: Two-Factor Authentication 雙因素認證
- **TOTP**: Time-based One-Time Password 基於時間的一次性密碼
- **SSO**: Single Sign-On 單一登入
- **RBAC**: Role-Based Access Control 角色型存取控制

---

## 文件簽核

| 角色 | 姓名 | 日期 | 簽名 |
|------|------|------|------|
| 產品經理 | - | 2025-08-25 | - |
| 技術主管 | - | 2025-08-25 | - |
| UX 設計師 | - | 2025-08-25 | - |
| QA 主管 | - | 2025-08-25 | - |