# Market Close Management - 市場休市管理

## 📋 基本信息

- **模組縮寫**: OP-MC
- **FR-ID**: FR-003
- **狀態**: 🔴 未開始
- **優先級**: 高
- **負責人**: 營運管理團隊

## 🎯 功能概述

市場休市管理模組負責管理各市場的休市日期和時間，確保系統在休市期間正確處理訂單、採購、生產和配送業務。此模組與其他業務模組緊密整合，提供即時的休市狀態查詢和業務影響評估。

## 📊 功能需求

### 核心功能
1. **休市日期管理**
   - 年度休市日曆設定
   - 臨時休市公告
   - 節慶假日管理
   - 颱風假處理
   - 黑名單日期設定

2. **休市規則設定**
   - 不同市場的休市規則
   - 休市期間業務限制
   - 緊急訂單處理規則
   - 特殊情況例外處理

3. **業務影響管理**
   - 休市對訂單的影響
   - 採購時程調整
   - 生產排程變更
   - 配送時程調整

### 技術需求
1. **整合需求**
   - 與 OM 模組整合（訂單管理）
   - 與 PM 模組整合（採購管理）
   - 與 MES 模組整合（生產管理）
   - 與 LM 模組整合（物流管理）

2. **通知機制**
   - 休市通知推送
   - 業務影響提醒
   - 時程調整通知
   - 緊急情況警報

3. **數據同步**
   - 即時狀態更新
   - 跨模組數據同步
   - 歷史記錄追蹤
   - 影響分析報告

## 🎨 用戶界面

### 管理界面
```
┌─────────────────────────────────────┐
│ 市場休市管理                        │
├─────────────────────────────────────┤
│ 市場選擇: [台北] [台中] [高雄] [全部]│
├─────────────────────────────────────┤
│ 日曆視圖 | 列表視圖 | 影響分析      │
├─────────────────────────────────────┤
│ 2024年8月日曆                       │
│ [1] [2] [3] [4] [5] [6] [7]        │
│ [8] [9] [10] [11] [12] [13] [14]   │
│ [15] [16] [17] [18] [19] [20] [21] │
│ [22] [23] [24] [25] [26] [27] [28] │
│ [29] [30] [31]                     │
├─────────────────────────────────────┤
│ 休市設定 | 規則管理 | 通知設定      │
└─────────────────────────────────────┘
```

### 影響分析界面
```
┌─────────────────────────────────────┐
│ 休市影響分析                        │
├─────────────────────────────────────┤
│ 日期: 2024-08-17                    │
│ 市場: 台北市場                      │
├─────────────────────────────────────┤
│ 受影響訂單: 15筆                    │
│ 受影響採購: 8筆                     │
│ 受影響生產: 3筆                     │
│ 受影響配送: 12筆                    │
├─────────────────────────────────────┤
│ 建議調整方案                        │
└─────────────────────────────────────┘
```

## 🔧 技術實現

### 前端技術
- **框架**: React 18
- **日曆組件**: FullCalendar
- **狀態管理**: Redux Toolkit
- **通知**: React-Toastify

### 後端技術
- **API**: RESTful API
- **數據庫**: PostgreSQL
- **快取**: Redis
- **消息隊列**: RabbitMQ

### 數據模型
```sql
-- 市場表
CREATE TABLE markets (
    id SERIAL PRIMARY KEY,
    code VARCHAR(10) UNIQUE NOT NULL,
    name VARCHAR(50) NOT NULL,
    region VARCHAR(20),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 休市日期表
CREATE TABLE market_closures (
    id SERIAL PRIMARY KEY,
    market_id INTEGER REFERENCES markets(id),
    closure_date DATE NOT NULL,
    closure_type VARCHAR(20) NOT NULL, -- 'holiday', 'typhoon', 'custom'
    description TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 休市規則表
CREATE TABLE closure_rules (
    id SERIAL PRIMARY KEY,
    market_id INTEGER REFERENCES markets(id),
    rule_type VARCHAR(20) NOT NULL, -- 'order', 'purchase', 'production', 'delivery'
    restriction_level VARCHAR(10) NOT NULL, -- 'block', 'warn', 'allow'
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

## 📝 驗收標準

### 功能驗收
- [ ] 休市日期設定正確
- [ ] 業務影響計算準確
- [ ] 通知機制正常運作
- [ ] 跨模組整合正常

### 性能驗收
- [ ] 日曆載入時間 < 2秒
- [ ] 影響分析響應 < 3秒
- [ ] 通知延遲 < 1分鐘
- [ ] 數據同步 < 5秒

### 品質驗收
- [ ] 代碼覆蓋率 > 80%
- [ ] 通過所有整合測試
- [ ] 用戶驗收通過
- [ ] 文檔完整性 > 90%

## 🧪 測試計畫

### 單元測試
- 休市日期驗證測試
- 影響計算邏輯測試
- 規則應用測試

### 整合測試
- 與 OM 模組整合測試
- 與 PM 模組整合測試
- 與 MES 模組整合測試
- 與 LM 模組整合測試

### 端到端測試
- 休市設定流程測試
- 影響分析流程測試
- 通知機制測試

## 📚 相關文檔

- [API 文檔](./api.md)
- [整合指南](./integration-guide.md)
- [業務規則](./business-rules.md)
- [部署指南](./deployment.md)

## 🔄 更新記錄

| 版本 | 日期 | 更新內容 | 負責人 |
|------|------|----------|--------|
| 1.0.0 | 2024-08-17 | 初始版本 | 營運管理團隊 |

## 📞 聯絡資訊

- **產品經理**: product@tsaitung.com
- **技術負責人**: tech@tsaitung.com
- **營運管理**: ops@tsaitung.com

---

**最後更新**: 2024-08-17  
**下次審查**: 2024-09-17
